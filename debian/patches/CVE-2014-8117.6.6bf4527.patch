Subject: Don't bail if there was no error, buf could have been NULL on entry
ID: CVE-2014-8117
Upstream-Author: Christos Zoulas <christos@zoulas.com>
Date: Thu Dec 4 15:22:05 2014 +0000
Origin: FILE5_20-42-g6bf4527
Last-Update: 2015-01-09

--- a/src/softmagic.c
+++ b/src/softmagic.c
@@ -1629,7 +1629,7 @@
 			fprintf(stderr, "indirect @offs=%u[%d]\n", offset, rv);
 
 		rbuf = file_pop_buffer(ms, pb);
-		if (rbuf == NULL)
+		if (rbuf == NULL && ms->event_flags & EVENT_HAD_ERR)
 			return -1;
 
 		if (rv == 1) {
